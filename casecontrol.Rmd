---
title: 'Rapid Epidemiological Analysis of Comorbidities and Treatments in COVID-19 in Scotland (REACT-SCOT): a case-control study based on the Scottish population [**Draft, not to be quoted**]'
author: 
  - name: Paul M McKeigue
    email: paul.mckeigue@ed.ac.uk
    affiliation: Usher
  - name: Amanda Weir 
    affiliation: HPS
  - name: Jen Bishop
    affiliation: HPS
  - name: Stuart J McGurnaghan
    affiliation: IGMM
  - name: Sharon Kennedy
    affiliation: HPS
  - name: David McAllister 
    affiliation: Glasgow
  - name: Chris Robertson 
    affiliation: Strathclyde
  - name: Rachael Wood
    affiliation: ISD
  - name: Nazir Lone
    affiliation: Usher
  - name: Janet Murray
    affiliation: HPS 
  - name: Thomas M Caparrotta 
    affiliation: IGMM
  - name: Sharon Hutchinson 
    affiliation: GCU
  - name: Helen M Colhoun
    affiliation: IGMM
address: 
   - code: Usher
     address: Usher Institute, College of Medicine and Veterinary Medicine, University of Edinburgh, Teviot Place, Edinburgh EH8 9AG, Scotland. PM - Professor of Genetic Epidemiology and Statistical Genetics. NL - Clinical Senior Lecturer in Critical Care
   - code: IGMM
     address: Institute of Genetics and Molecular Medicine, College of Medicine and Veterinary Medicine, University of Edinburgh, Western General Hospital Campus, Crewe Road, Edinburgh EH4 2XUC, Scotland. HC - Axa Chair in Medical Informatics and Epidemiology. TC - Sir George Alberti Doctoral Fellow in Pharmacoepidemiology. 
   - code: Glasgow
     address: Institute of Health and Wellbeing, University of Glasgow, 1 Lilybank Gardens, Glasgow G12 8RZ. DM - Senior Clinical Lecturer in Public Health 
   - code: HPS
     address: Health Protection Scotland (Public Health Scotland), Meridian Court, 5 Cadogan Street, Glasgow G2 6QE
   - code: Strathclyde
     address: Department of Mathematics and Statistics, University of Strathclyde, 16 Richmond Street, Glasgow G1 1XQ. CR - Professor of Public Health Epidemiology
   - code: GCU
     address: School of Health and Life Sciences, Glasgow Caledonian University. SH - Professor of Epidemiology and Population Health 
   - code: ISD
     address: NHS Information Services Division (Public Health Scotland), Gyle Square, 1 South Gyle Crescent, Edinburgh, EH12 9EB.  RW - Consultant in Maternal and Child Health. 
geometry: margin=1in
fontsize: 11pt
linenumbers: true
bibliography: ../covid.bib
date: "This version compiled `r gsub('^0', '', format(Sys.time(), '%d %B %Y'))`"
header-includes: |
  \let\origquote\quote
  \def\quote{\origquote\itshape}
  \usepackage{graphicx}
  \usepackage{longtable}
  \usepackage{booktabs}
  \usepackage{float}
  \usepackage{array}
  \usepackage{booktabs}
  \usepackage{longtable}
  \usepackage{lscape}
output: 
#  pdf_document:
  rticles::plos_article:
    latex_engine: lualatex
    fig_caption: true
    keep_tex: true
#    toc: true
#    toc_depth: 2
csl: ../plos.csl
urlcolor: red

# rmarkdown::render("casecontrol.Rmd", output_file="casecontrol.pdf")

---

```{r functions, echo=FALSE}
library(knitr)
library(kableExtra)

knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)

source("helperfunctions.R")

table.densities <- rbind(summary(demog.densities),
                         summary(listed.densities),
                         summary(full.densities))[, 1:6]

```

\newpage

# Abstract

_Background_-- Why some people infected with SARS-CoV-2 develop severe COVID-19 disease and others do not is poorly understood.  The objectives of this study were to identify risk factors for severe disease and to lay the basis for risk stratification based on demographic data and health records. 

_Methods_ -- The design was a matched case-control study. Test-positive cases were ascertained as all those with a positive nucleic acid test for SARS-CoV-2 in the national database and from national mortality data.  Those who had been admitted to intensive care or had died within 28 days of a positive test were classified as severe cases.  For each case, ten controls matched for sex, age and primary care practice were selected from the population register.  For cases and controls we extracted all diagnostic codes from the past five years of hospital discharge records, all drug codes from encashed prescriptions issued in primary care care during the past year and linked to the national diabetes register.  Rate ratios for associations with severe COVID-19 were estimated by conditional logistic regression.  The performance of a predictive model for severe COVID-19 was estimated by cross-validation.

_Findings_ -- In a logistic regression based on the age-sex distribution of the national population, the odds ratios were `r round(exp(10 * logistic.coeffs[3, 1]), 2)` for a 10-year increase in age and `r round(exp(-logistic.coeffs[2, 1]), 2)` for male sex.  In the case-control analysis, the strongest risk factor was residence in a care home, with rate ratio (95% CI) `r table.agegr.all[1, 3]` .  Rate ratios (95% CIs) for conditions previously designated as conferring high risk were  
`r table.agegr.all[4, 3]` for diabetes, 
`r table.agegr.all[8, 3]` for chronic renal failure, 
`r table.agegr.all[5, 3]` for ischemic heart disease,
`r table.agegr.all[6, 3]` for other heart disease, 
`r table.agegr.all[9, 3]` for neurological disease, 
`r table.agegr.all[10, 3]` for chronic liver disease and 
`r table.agegr.all[11, 3]` for immune deficiency or suppression.

Overall `r freqs.all[13, 2]` of severe cases and `r freqs.all[13, 1]` of controls had at least one of these listed conditions.  In those aged under 40 years the frequencies of any listed condition were `r gsub("\\\\", "", table.agegr[13, 2])` in cases and `r gsub("\\\\", "", table.agegr[13, 1])` in controls.  The odds ratio for severe disease associated with encashment of at least one prescription in the past year was `r table.agegr.all[2, 3]` and the odds ratio associated with at least one hospital admission in the past five years was `r table.agegr.all[3, 3]`).  These associations remained after excluding those with any of the listed conditions.  The associations with hospital diagnoses were distributed over most chapters of the ICD-10 and the associations with prescribed drugs were distributed over most chapters of the British National Formulary.  

With a model based on age and sex alone, the expected information for discrimination was `r round(cases.Lambda.agesex, 2)` bits.  The additional information for discrimination conditional on age and sex was `r table.densities[1, 5]` bits for a model based on demographic variables only, `r table.densities[2, 5]` bits for a model that included the listed conditions, and `r table.densities[3, 5]` bits for a model that included indicator variables for hospital diagnoses and prescription encashments. 

_Conclusions_ --Along with older age and male sex, severe COVID-19 disease is strongly associated with past medical history; most younger persons developing severe disease have an underlying medical condition. The comorbidities associated with increased risk are not limited to the lists of risk conditions designated by public health agencies.  A risk classifier that uses all the information available in medical and prescribing records, rather than only a limited set of conditions, will more accurately discriminate between low-risk and high-risk individuals who may require shielding until the SARS-CoV-2 epidemic is over.  

\newpage

# Background
Case series from many countries have suggested that in those with severe COVID-19 the prevalence of diabetes and cardiovascular disease is higher than expected.  For example in a large UK series the commonest co-morbidities were cardiac disease, diabetes, chronic pulmonary disease and asthma [@docherty_features_2020]. However there are also anecdotal reports of apparently healthy young persons succumbing to disease [@mcgoogan_why_2020].

Quantification of the risk associated with characteristics and co-morbidities has been limited by the lack of comparisons with the background population [@zhou_clinical_2020;@grasselli_baseline_2020;@guan_clinical_2020].  Two recent studies in the UK have included population comparators and have reported associations with co-morbidities including diabetes, asthma and heart disease. [@niedzwiedz_ethnic_2020; @the_opensafely_collaborative_opensafely_2020].  A systematic comparison of medical records in those with and without severe disease has not yet been reported.

We report a systematic examination of the health care record and prescribing history among all people who have developed severe COVID-19 disease in Scotland compared to the general population. The objectives were to identify risk factors and to lay the basis for risk stratification based on a predictive model.  

# Methods
## Case definition 
The Electronic Communication of Surveillance in Scotland (ECOSS) database captures all virology testing in all NHS laboratories nationally, using the Community Health Index (CHI) identifier.  The CHI number is a unique identifier used in all care systems in Scotland.  All individuals testing positive for nucleic acid for SARS-CoV-2 up to `r format(max(cc.all$SPECDATE, na.rm=TRUE), "%d %B %Y")` were ascertained.  Hospital admissions from the time of testing were obtained from the RAPID-24 database which is updated each day and from the Scottish Morbidity Record 01 which is updated weekly.  Admissions to critical care were obtained from the Scottish Intensive Care Society and Audit Group (SICSAG) database that covers all critical care units in Scotland. Death registrations up to `r format(max(cc.all$Date.Death, na.rm=TRUE), "%d %B %Y")` were obtained from linkage to the National Register of Scotland.  

Severe or fatal COVID-19 was defined by a record of entering critical care in the SICSAG database, or death within 28 days of a positive nucleic acid test, regardless of the cause of death given on the death certificate.  By restricting the case definition to cases that were fatal or received critical care, we ensured complete ascertainment of all test-positive cases that were severe enough to have been fatal without critical care, irrespective of any selection that may have excluded those assessed as unlikely to benefit from critical care. 

## Matched controls
For each test-positive case, we ascertained ten matched controls of the same sex, one year age band and attending the same General Practice as each case alive on the same day as the date of test in the case using the Community Health Index (CHI) database. As this is an incidence density sampling design, it is possible and correct for an individual to appear in the dataset more than once, initially as a control and subsequently as a case.  

## Demographic data
Socioeconomic status was scored in the CHI database as the Scottish Index of Multiple Deprivation, an indicator based on postal code.  Ethnicity was assigned based on applying a name classification algorithm (ONOMAP) [@lakha_name_2011] to the names in the CHI database.  This classification is able to distinguish South Asians, the largest non-White minority in Scotland, from those who identify as White with fair accuracy but misclassifies most of those who identify as Black or Black-Caribbean (a much smaller minority in Scotland) as White. <!--- For cases and controls who had a past record of hospital admission or outpatient attendance in the Scottish Morbidity Record, a separate classification of ethnicity was available, assigned by self-report or by hospital staff and based on the categories used in the Census. ---> 

## Morbidity and drug prescribing
For all cases and controls, ICD-10 diagnostic codes were extracted from the last five years of hospital discharge records in the Scottish Morbidity Record (SMR01), excluding records of discharges less than 25 days before testing positive for SARS-CoV-2 and using all codes on the discharge. British National Formulary (BNF) drug codes were extracted from the last year of encashed prescriptions, excluding those encashed less than 25 days before testing positive.   Diagnosed cases of diabetes were identified through linkage to the national diabetes register (SCI-Diabetes), with a clinical classification of diabetes type as Type 1, Type 2 or Other.  

We began by scoring a specific list of conditions that have been designated as risk conditions for COVID-19 by public health agencies [@nhs_whos_2020].  These listed conditions were assigned based on diagnostic codes in any hospital discharge record during the last five years, or encashed prescription of a drug for which the only indications are in that group of diagnostic codes. The ICD-10 codes and drug codes used to define each variable are listed in the R script provided as Supplementary Material. In addition to these pre-specified groupings of codes we tabulated associations with all ICD-10 codes and BNF codes to chapter level.  A
separate list of conditions has been used to designate "clinically extremely vulnerable" who have been advised to shield themselves completely since early in the epidemic: this list includes solid organ transplant recipients, people receiving chemotherapy for cancer, and people with cystic fibrosis or leukaemia.  We did not separately tabulate these conditions as we expected these individuals to be underrepresented among cases if shielding was adequate.  

## Statistical methods
To estimate the relation of cumulative incidence and mortality from COVID-19 to age and sex, logistic regression models were fitted to the proportions of cases and non-cases in the Scottish population, using the estimated population of Scotland in mid-year 2019 which are available by one-year age group up to age 90 years. For the case-control study, estimates of associations with severe COVID-19 were based on conditional logistic regression, implemented as Cox regression in the R function `survival::clogit`.  Among those cases and controls without any of the pre-defined conditions we then further examined associations of ICD-10 and BNF chapter with severe COVID-19. Where the sample of cases and controls is restricted, this will generate strata that contain no cases.  These strata will be ignored by the conditional logistic regression model as they do not contribute to the conditional likelihood.  With incidence density sampling, the odds ratios in conditional logistic regression models are equivalent to rate ratios.  These odds ratios based on the conditional likelihood will differ from the unconditional odds ratios calculable from the frequencies of exposure in cases and controls [@breslow_estimation_1978]

To construct risk prediction models, we used stepwise regression alternating between forward and backward steps to maximize the AIC, implemented in the R function `stats::step`.  The performance of the risk prediction model as a classifier was examined by 4-fold cross-validation, with performance calculated over all test folds as the expected information for discrimination $\Lambda$ [@mckeigue_quantifying_2019] and (more conventionally) as the C-statistic. The rationale for using $\Lambda$ to quantify the predictive performance of a binary classifier, and especially to quantify increments in predictive performance, has been explained elsewhere [@mckeigue_quantifying_2019].  A key advantage of using $\Lambda$ is that the contributions of independent predictors are additive on the scale of $\Lambda$.  The class-conditional distributions of weights of evidence in cases and controls encode exactly the same information as the receiver operating characteristic curve, when these distributions are adjusted for mathematical consistency as described elsewhere [@mckeigue_quantifying_2019] to obtain the model-based distributions.  The likelihood ratio at any given sensitivity and specificity is the gradient of the model-based ROC curve.  

In this study we have estimated the information for discrimination provided by age and sex (from a logistic regression model in the general population), and the information for discrimination provided by other risk factors conditional on age and sex (from conditional logistic regression models in this case-control study matched for age and sex).  We can add these to obtain the total information for discrimination that would be obtained with a classifier in the general population.  As described elsewhere, this can be used to estimate the proportion of those destined to develop severe or fatal disease who would be correctly classified as high risk under a shielding policy [@mckeigue_evaluation_2020]. 

## Information governance
This study was conducted under approvals from the  Privacy Advisory Committee ref 44/13  and Public Benefit Privacy Protection amendment 1617-0147 . Datasets were de-identified before analysis.  

# Results
## Incidence and mortality from severe COVID-19 in the Scottish population
Figure \ref{fig:rates} shows the relationships of incidence and mortality rates to age for each sex separately.  The relationship of mortality to age is almost exactly linear on a logit scale, and the lines for males and females are almost exactly parallel.  For severe cases as defined in this study, the sex differential is narrow up to about age 50 but widens between ages 50 and 70 years.  This implies that at younger ages the ratio of critical care admissions to total fatalities is higher in women than in men, but that at later ages the ratio of critical care admissions to total fatalities is higher in men.  In models that included  age and sex as covariates, the odds ratio associated with a 10-year increase in age was `r round(exp(10*logistic.coeffs[3, 1]), 2)` for all severe disease and `r round(exp(10*logistic.coeffs[3, 2]), 2)` for fatal disease.  The odds ratio associated with male sex was `r round(exp(-logistic.coeffs[2, 1]), 2)` for all severe disease and `r round(exp(-logistic.coeffs[2, 2]), 2)` for fatal disease.  As shown in Table \ref{tab:agegr} almost all severe cases over aged 75 years died but most severe cases under aged 60 survived. 

## Association with demographic factors
Table \ref{tab:demog} shows univariate associations of demographic factors with severe disease.  Residence in a care home was by far the strongest risk factor for severe disease.  Higher risk of severe disease was also associated with socioeconomic deprivation.  In comparison with those classified as White, South Asians and other non-White ethnic minorities were at lower risk of severe disease.  Table \ref{tab:ethnicsmr} shows a separate analysis restricted to those with ethnicity recorded in hospital records, which allows those who identify as Black to be distinguished from those who identify as White.  The numbers of cases and controls classified as Black are too small for the risk in this group to be estimated reliably. 

## Associations with listed conditions
Overall `r freqs.all[13, 2]` of severe cases and `r freqs.all[13, 1]` of controls had at least one of the listed conditions.  The prevalence of the listed conditions in cases and controls by age band is shown in Table \ref{tab:agegr}.  `r gsub("\\\\", "", table.agegr[13, 2])` of the cases aged under 40 years had at least one listed condition, compared with only `r gsub("\\\\", "", table.agegr[13, 1])` of the controls.  In those aged 75+ years `r gsub("\\\\", "", table.agegr[13, 8])` of the cases and `r gsub("\\\\", "", table.agegr[13, 7])` of the controls had at least one listed condition.

Tables \ref{tab:listed.conditions.lt60} to \ref{tab:listed.conditions.ge75} examine these associations by age group, with the 0-39 and 40-59 age bands combined.  All listed conditions were associated with severe disease in each age band.  Diabetes was associated with a 6.6 fold rate of severe COVID-19 under age 60 years.  The associations with severe COVID-19 were stronger for the broad category "other heart disease" than for ischaemic heart disease.  

Tables \ref{tab:listed.conditions.lt60} to \ref{tab:listed.conditions.ge75} also show multivariate rate ratios by age group. These table show that even after adjusting for care home residence and listed conditions, encashment of any prescription in the past year and any admission to hospital in the past five years were strongly and independently associated with severe disease.  

## Systematic analysis of diagnoses associated with severe disease
The approximately two-fold risk of with severe COVID-19 associated with prior hospital admission independently of other conditions and factors was examined further by testing for association of hospitalisations at each ICD-10 chapter level with severe COVID-19, restricted to those without any of the listed conditions.  These results are shown in Table \ref{tab:conditions}.  In univariate analyses, almost all ICD chapters, with the exception of Chapters 8 (ear) and Chapter 15 (pregnancy) were associated with increased risk of severe disease.  The strongest residual associations were seen with neoplasms. Table \ref{tab:icdsubchapters} extracts univariate associations with ICD subchapters where the p-value is <0.001 and where there are at least 50 cases and controls with a diagnosis in this subchapter.  This table shows that many subchapter diagnoses are associated with markedly higher risk of severe COVID-19.  We note that past hospital diagnoses of infections, pneumonia and acute respiratory diseases are strongly associated with severe COVID-19.  Associations with cardiovascular disease are not limited to heart disease but are also present for stroke and other circulatory disorders that are not designated as risk conditions. 

## Associations of prescribed drugs with severe disease 
Tables \ref{tab:listed.conditions.lt60} to \ref{tab:listed.conditions.ge75} show that the strongest risk factor for severe disease, apart from residence in a care home, is the encashment of at least one prescription in the last year.  The univariate rate ratio associated with this variable varies from `r tables.agegr[[1]][2, 3]` in those aged under 60 years to `r tables.agegr[[3]][2, 3]` in those aged 75 years and over.  In a multivariate analysis adjusting for care home residence, any hospital admission and listed conditions, these rate ratios were reduced to `r tables.agegr[[1]][2, 5]` and `r tables.agegr[[3]][2, 5]` About one third of those over 75 had not encashed a prescription in the previous year. 

To investigate this further, we partitioned the "Any prescription" variable into indicator variables for each chapter of the British National Formulary, in which drugs are grouped by broad indication, and restricted the analysis to those without one of the listed conditions.  Table \ref{tab:drugs} shows these associations.  In univariate analyses, prescriptions in almost all BNF chapters were associated with severe disease.  In a multivariate analysis of all chapters, these associations were much weaker.  The BNF chapter with the strongest association with severe disease was Chapter 1 (gastrointestinal).  Other chapters associated with severe disease were Chapter 2 (cardiovascular) and Chapter 4 (central nervous system). 

## Construction of a multivariate risk prediction model 
To evaluate the incremental contributions of the listed conditions, and residual information in hospitalisation and prescription records data after assigning these conditions, predictive models were constructed from three sets of variables: a baseline set consisting only of demographic variables, a set that included indicator variables for each listed condition, and an extended set that included demographic + listed conditions + indicator variables for hospital diagnoses in each ICD-10 chapter and prescriptions in each BNF chapter.  

For each variable set, a stepwise regression procedure was carried out using alternating forward-backward selection. The variables retained with each variable set are shown in Table \ref{tab:stepwise} . The predictive performance of the model chosen by stepwise regression was estimated by `r nfold`-fold cross-validation.  Observed and predicted case status were compared over all test folds.  Table \ref{tab:xvalid} shows that using the extended set increased the C-statistic from `r table.densities[2, 3]` to `r table.densities[3, 3]` and the expected information for discrimination from `r table.densities[2, 5]` bits to `r table.densities[3, 5] ` bits.  

This estimate of `r table.densities[3, 5] ` bits for the information conditional on age and sex obtained from the matched case-control study can be added to the information for discrimination `r round(cases.Lambda.agesex, 2)` bits obtained from the logistic regression on age and sex in the population using age and sex to estimate the total information for discrimination of a risk classifier that would be obtained in the population to give a total of `r table.densities[3, 5] + round(cases.Lambda.agesex, 2)` bits. 

Figure \ref{fig:wevid} shows the class-conditional distributions of the weight of evidence $W$ favouring case over control status from the model based on the extended variable set.  The model-based distributions have been adjusted slightly to make them mathematically consistent as described elsewhere [@mckeigue_quantifying_2019].  This shows, as expected for a multifactorial classifier, that the distributions are approximately Gaussian: there is no clear divide between high-risk and low-risk individuals of the same age and sex. Figure \ref{fig:roc} shows the corresponding receiver operating characteristic (ROC) curve, which encodes the same information as Figure \ref{fig:wevid} but does not allow the separation of cases and controls by the risk classifier to be easily visualized. 

# Discussion  
### Sociodemographic features
In this analysis of sociodemographic factors and past medical history we found a large number of factors to contribute to risk of severe COVID-19 disease.  Apart from the very steep rise in risk with age, severe disease is more likely in men, and those who are more socioeconomically disadvantaged.  Regarding sex differences we noted that the ratio of non-fatal cases who receive critical care to fatal cases is lower in females than in males in the 50-70 year age range.  This may reflect either an underlying divergence in case fatality, or that women are less likely than men to be transferred to critical care if they have a good chance of surviving without critical care.  The effect of matching on general practice which will partly match for socioeconomic disadvantage will reduce the precision of the effect of the socioeconomic indicator (SIMD) in our analysis but will not bias it in either direction.  Residence in a care home was associated with a 15-fold increased risk of severe COVID-19 in this age matched analysis and this was reduced to eight-fold by adjustment for listed conditions. This eight-fold risk is likely to reflect both the spread of the epidemic in care homes and residual confounding by frailty.

In contrast to reports from England [@the_opensafely_collaborative_opensafely_2020] we found that people of South Asian ethnicity, and other non-White minorities, are at lower risk than Whites. This suggests that socioeconomic rather than genetic factors underlie at least some of the associations of risk with ethnicity reported in England.  In the OpenSAFELY cohort, those recorded as Black and Asian people were at 1.7 fold and 1.6 fold risk of death respectively compared with those recorded as White, after adjustment for comorbidities and socioeconomic status, However in a recent report based on the UK Biobank cohort, almost half of the fourfold risk ratio for hospitalised COVID associated with Black ethnicity was accounted for by health care worker status, with other social variables attenuating the risk ratio further [@niedzwiedz_ethnic_2020; @ho_modifiable_2020].  We note that the proportion of health care workers that are of non-British nationality varies across the UK from [23% in London to 7% in Scotland](https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/internationalmigration/articles/internationalmigrationandthehealthcareworkforce/2019-08-15). 

### Co-morbidities
We have confirmed that the " moderate risk " conditions designated by the NHS and other agencies [@nhs_whos_2020] are associated with increased risk of severe COVID-19.  However the rate ratios associated with these conditions vary with age - for example the rate ratio associated with diabetes is higher at younger ages. The 2.7 fold rate ratio in all ages combined is similar to that reported in UK Biobank and in the OpenSAFELY studies.  We confirm the higher risk with asthma and chronic lung disease and liver disease reported in these and earlier studies.  Of note other heart disease is more strongly associated than ischaemic heart disease.  This category includes conditions such as atrial fibrillation, cardiomyopathies and heart failure.  However overall 26% of cases did not have any of these listed conditions.  Among cases and controls without these conditions not surprisingly neoplasms were associated with severe COVID-19; we had omitted it from the pre-specified list as in the current dataset we cannot separately identify those who are currently receiving chemotherapy or radiotherapy for whom shielding is advised.  We have not attempted to estimate the risk associated with these conditions for which shielding is recommended, as the observed risk will depend on the adequacy of shielding rather than on the risk to those exposed to the epidemic.  A further systematic evaluation of past hospitalisation history did not reveal a sparse set of conditions underlying severe disease but rather many associated diagnoses.  Past hospital admission for influenza or respiratory tract infection, though not usually designated as a high-risk condition, is an important and easily-scored risk factor for severe COVID-19.  

Media reports of apparently healthy young people succumbing to severe COVID-19 have disseminated the message that all are at risk of disease whatever their age or health status.  However we found that almost half of cases under 40 years had at least one of the listed conditions.  Among those who did not have a listed condition, the proportions who had had at least one hospital admission in the past five years and had encashed at least one prescription in the past year where much higher among cases than in controls.  Thus even among younger persons, most cases of severe disease are attributable to pre-existing health conditions. 

## Possible drug effects
A striking finding of this study was the strong association of severe COVID-19 with having encashed at least one prescription in the past year, only partly explained by higher rates of prescribing among those with listed conditions.  Partitioning of this association between BNF chapters, which represent broad indication-based drug classes, showed that the strongest association was with prescription of Chapter 1 drugs, prescribed for gastrointestinal conditions, which are not generally listed as risk factors for severe COVID-19 .  Also associated were those in the cardiovascular, nervous system and nutritional and blood chapters.  Although it is likely that most associations of severe COVID-19 with drug prescribing are attributable to the indications for which these drugs were prescribed, causal effects of drug classes cannot be ruled out.  These association, and possible explanations, are explored in an accompanying paper.  

## Relevance to policy
As lockdown restrictions are eased, there is general agreement that vulnerable individuals will require shielding, even if the restart of the epidemic can be slowed or suppressed by mass testing, contact tracing and isolation of those who test positive.  The "stratify and shield" policy option [@mckeigue_evaluation_2020], in which high-risk individuals comprising up to 15% of the population are shielded for a defined period while the epidemic is allowed to run relatively quickly in low-risk individuals until population-level immunity is attained, depends critically on accurate risk discrimination.   So too does the similarly named "segment and shield " option [@bunnik_segmentation_2020] which has the opposite objective of keeping transmissions low. 

It is to be expected that as awareness grows of how risk varies between individuals, individuals will seek to learn whatever they can about their own level of risk.  A key implication of our results is that risk of severe or fatal disease is multifactorial and that the ninefold rate ratio associated with a 20-year difference in age is far stronger than that associated with conditions such as diabetes, asthma, and neurological conditions that impair mobility.  A corollary of this is that a crude classification based on assigning all persons with a listed condition to a group for whom shielding is recommended will have poor specificity, as one-third of those aged 60-74 year olds in the population have at least one of the listed conditions we examined.  It will also exclude many people at high risk because they have multiple risk factors.  The only way to optimize risk classification so as to ensure equity with respect to risk is to construct a classifier that uses all available information to assign a risk score.  Our results show that this is possible in principle: in Scotland it is technically possible to use existing electronic health records to calculate a risk score for every individual in the population, though more work would be required to develop this as a basis for official advice and individual decisions.  

## Methodological strengths and weaknesses
Most reports of disease associations with COVID-19 have been case series.  There have been few reports based on evaluating these associations in the population through cohort or case-control studies.  With this matched case control design using incidence density sampling, we have been able to estimate rate ratios conditional on age and sex.  An unpublished analysis from England explored the association of similar set of risk conditions with in-hospital COVID-19 deaths, but did not systematically evaluate the rest of the medical record including prescription records.  Although we have records of encashment of prescriptions, we do not at present have access to other primary care data, which would contain additional information on morbidity and measurements such as body mass index.  A strength of our study however is that hospital discharge diagnoses are coded to ICD-10 by trained coders, in contrast to the coding systems used in primary care databases that do not map to recognized disease classifications.  Associations with ethnicity and other sociodemographic factors are not necessarily generalizable from Scotland to other populations.  

This case-control study is limited to test-positive cases, excluding deaths where no testing was carried out but COVID-19 was mentioned on the death certificate as an underlying or contributing cause.  Up to 13 May 2020 an additional 1200 such deaths had been reported by the [National Registers of Scotland.](https://www.nrscotland.gov.uk/statistics-and-data/statistics/statistics-by-theme/vital-events/general-publications/weekly-and-monthly-data-on-births-and-deaths/deaths-involving-coronavirus-covid-19-in-scotland) Future versions of this analysis will include sensitivity analyses of the extent to which the results are changed by including these deaths, but the data are not yet available.  Apart from residential care home status, we do not expect most other risk factors to differ markedly between those who died from COVID-19 without being tested and those who died after testing.  

# Conclusion
This study confirms that risk of severe COVID-19 is associated with sociodemographic factors and with chronic conditions such as diabetes, asthma, circulatory disease and others. However the associations with pre-existing disease are not just with a small set of conditions that contribute to risk, but with many conditions as demonstrated by associations with past medical and prescribing history in relation to multiple physiological systems.  As countries attempt to emerge from lockdown whist protecting the most vulnerable multivariate classifiers rather than crude rule-based approaches will be needed to define those most at risk.

# References

<div id="refs"></div>


```{r plotrates, echo=FALSE, fig.pos="H", fig.cap="\\label{fig:rates}Incidence of severe and fatal COVID-19 in Scotland by age and sex: generalized additive models fitted to severe and fatal cases for males and females separately", out.width="0.8\\textwidth"}

breaks.gam <- c("1/20,000", "1/10,000", "1/5,000",
                "1/2000", "1/1000", "1/500",
                "1/200", "1/100")
theme_set(
    theme_gray(base_size = 14)
)

ggplot(data=gam, aes(x=Age, y=value, colour=Sex, linetype=Status)) +
    geom_line() +
    scale_x_continuous(name="Age", limits=c(20, 90),
                       breaks=seq(20, 80, by=20),
                       labels=seq(20, 80, by=20)) + 
    scale_y_continuous(name="Risk (logit scale)",
                       breaks=car::logit(c(5E-5, 1E-4, 2E-4,
                                           5E-4, 1E-3, 2E-3,
                                           5E-3, 1E-2)),
                       labels=breaks.gam,
                       limits=car::logit(c(2E-5, 5E-3)))
```

\newpage

```{r plotwdists, echo=FALSE, fig.pos="H", fig.cap="\\label{fig:wevid}Cross-validation of model chosen by stepwise regression using extended variable set: class-conditional distributions of weight of evidence", out.width="0.8\\textwidth"}

plotWdists(full.densities) + theme_grey(base_size = 18) + 
	theme(legend.title=element_blank())

```

```{r plotroc, echo=FALSE, fig.cap="\\label{fig:roc}Cross-validation of model chosen by stepwise regression using extended variable set: receiver operating characteristic curve", out.width="0.8\\textwidth"}

plotroc(full.densities) +
    scale_color_manual(values=c("orange", "purple")) + 
    coord_fixed(ratio=1) +
    theme(axis.title=element_text(size=18)) +
    theme(legend.title=element_blank()) + 
    theme(legend.position=c(0.8, 0.2)) + 
    scale_x_reverse(limits=c(1, 0), expand=c(0, 0)) +
    scale_y_continuous(limits=c(0, 1), expand=c(0, 0)) +
    xlab("Specificity") +
    ylab("Sensitivity (reverse scale)")

```

\newpage

```{r demog, echo=FALSE, warning=FALSE, message=FALSE}
options(knitr.kable.NA = '')

knitr::kable(table.demog.aug[, 1:4],
             escape=FALSE, 
             booktabs=TRUE,
             label="demog",
             col.names=c(clean.header(colnames(table.demog.aug)[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Univariate associations of severe disease with demographic factors") %>%
    column_spec(column=1, width="3cm") %>%
    column_spec(column=2, width="2cm") %>%
    column_spec(column=3, width="1.8cm") %>%
    column_spec(column=4, width="2.5cm") %>%
    group_rows("Ethnicity", 1, 3) %>%
    group_rows("SIMD quintile", 4, 8)

```

```{r agegr, echo=FALSE, warning=FALSE, message=FALSE}

rownames(table.agegr) <- replace.names(rownames(table.agegr))
table.agegr[1, c(1, 3, 5, 7)] <- " "
knitr::kable(table.agegr,
             escape=FALSE, 
             booktabs=TRUE,
             label="agegr",
             align=rep("c", 8), 
             caption="Associations of severe disease with risk factors, by age group") %>%
    column_spec(column=1, width="3.5cm") %>%
    group_rows("Listed condition", 5, nrow(table.agegr) - 1) %>%
    add_header_above(c(" "=1, "0-39 years"=2, "40-59 years"=2,
                       "60-74 years"=2, "75+ years"=2)) %>%
    landscape()

```

```{r listed.conditions.allages, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(table.agegr.all,
             escape=FALSE, 
             booktabs=TRUE,
             label="listed.conditions.allages",
             digits=c(0, 0, 0, 200, 0, 200), 
             col.names=c(clean.header(colnames(table.agegr.all)[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe disease with listed conditions over all age groups") %>%
    group_rows("Listed condition", 4, nrow(table.agegr.all)) %>%
    column_spec(column=1, width="4cm") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Multivariate"=2)) %>%
    landscape()

```

```{r conditions, echo=FALSE, warning=FALSE, message=FALSE}

rownames(table.conditions.aug) <- gsub("_", " ", rownames(table.conditions.aug))
knitr::kable(table.conditions.aug,
             escape=FALSE, 
             booktabs=TRUE,
             label="conditions",
             digits=c(0, 0, 0, 200, 0, 200), 
             col.names=c(clean.header(colnames(table.conditions.aug)[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe disease with hospital diagnoses in last 5 years, in those without any listed condition") %>%
    column_spec(column=1, width="4cm") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Multivariate"=2)) %>%
    landscape()

```

```{r drugs, echo=FALSE, warning=FALSE, message=FALSE}

rownames(table.drugs.aug) <- gsub("_", " ", rownames(table.drugs.aug))
knitr::kable(table.drugs.aug,
             escape=FALSE, 
             booktabs=TRUE,
             label="drugs",
             digits=c(0, 0, 0, 200, 0, 200), 
             col.names=c(clean.header(colnames(table.drugs.aug)[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6),
             caption="Associations of severe disease with prescribed drugs in those without any listed condition") %>%
    column_spec(column=1, width="4.5cm") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Multivariate"=2)) %>%
    landscape()
```

```{r infodiscrim, echo=FALSE, warning=FALSE, message=FALSE}


rownames(table.densities) <- c("Demographic only",
                               "Demographic + listed conditions",
                               "Extended variable set")
table.densities[, 6] <- round(table.densities[, 6] - table.densities[1, 6], 1)


knitr::kable(table.densities, 
             booktabs=TRUE,
             escape=FALSE,
              row.names=TRUE,
             label="xvalid",
             align=rep("c", 6),
             caption="Prediction of severe COVID-19: cross-validation of models chosen by stepwise regression") %>%
    column_spec(column=1, width="2.5cm") %>%
    column_spec(column=2:7, width="1.5cm")
 
```

\newpage

# Appendix
## Supplementary tables

```{r ethnicsmr, echo=FALSE, warning=FALSE, message=FALSE}

options(knitr.kable.NA = '')
if(FALSE) {
knitr::kable(table.ethnicsmr.aug,
             escape=FALSE, 
             booktabs=TRUE,
             label="ethnicsmr",
             digits=c(0, 0, 0, 200), 
             col.names=c(clean.header(colnames(table.ethnicsmr.aug)[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe disease with ethnicity classified in hospital records") %>%
    column_spec(column=1, width="3cm")
}
```

```{r listed.conditions.lt60, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(tables.agegr[[1]],
             escape=FALSE, 
             booktabs=TRUE,
             label="listed.conditions.lt60",
             digits=c(0, 0, 0, 200, 0, 200), 
             col.names=c(colnames(tables.agegr[[1]])[1:2],
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe disease with listed conditions in those aged less than 60") %>%
    group_rows("Listed condition", 4, nrow(tables.agegr[[1]])) %>%
    column_spec(column=1, width="4cm") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Multivariate"=2)) %>%
    landscape()

```
```{r listed.condition.60to74, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(tables.agegr[[2]],
             escape=FALSE, 
             booktabs=TRUE,
             label="listed.conditions.60to74",
             digits=c(0, 0, 0, 200, 0, 200), 
             col.names=c(colnames(tables.agegr[[2]])[1:2],
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe disease with listed conditions in those aged 60-74 years") %>%
    group_rows("Listed condition", 4, nrow(tables.agegr[[2]])) %>%
    column_spec(column=1, width="4cm") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Multivariate"=2)) %>%
    landscape()

```

```{r listed.condition.75plus, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(tables.agegr[[3]],
             escape=FALSE, 
             booktabs=TRUE,
             label="listed.conditions.ge75",
             digits=c(0, 0, 0, 200, 0, 200), 
             col.names=c(clean.header(colnames(tables.agegr[[3]])[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe disease with listed conditions in those aged 75 years and over") %>%
    group_rows("Listed condition", 4, nrow(tables.agegr[[3]])) %>%
    column_spec(column=1, width="4cm") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Multivariate"=2)) %>%
    landscape()

```

```{r icdsubchapters, echo=FALSE, warning=FALSE, message=FALSE}
clean.header <- function(x) {
    x <- gsub("\\.\\.", " (", x)
    x <- gsub("\\.",  ")", x)
    return(x)
}

knitr::kable(table.icdsubchapters,
             escape=FALSE, 
             booktabs=TRUE,
			 longtable=TRUE, 
             label="icdsubchapters",
             col.names=c(clean.header(colnames(table.icdsubchapters)[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe disease with hospital diagnoses by ICD subchapters: rows retained are those with p < 0.001 and at least 50 cases and controls") %>%
    column_spec(column=1, width="13cm") %>%
    column_spec(column=2:3, width="1.5cm") %>%
    column_spec(column=5, width="1.5cm") %>%
    landscape()

```


```{r model, echo=FALSE, warning=FALSE, message=FALSE}

retained.full <- as.data.frame(stepwise.full[, c(1, 5)])
retained.full[, 1] <- round(retained.full[, 1], 2)
retained.full[, 2] <- signif(retained.full[, 2], 1)

rownames(retained.full) <- gsub("\\.quintile", "\\.quintile ", rownames(retained.full))
rownames(retained.full) <- gsub("([a-z])1", "\\1", rownames(retained.full))
rownames(retained.full) <- gsub("care.home", "", rownames(retained.full))
rownames(retained.full) <- gsub("dm\\.type", "", rownames(retained.full))

rownames(retained.full) <- replace.names(rownames(retained.full))
rownames(retained.full) <- gsub("\\_", " ", rownames(retained.full))

retained.full[, 2] <- pvalue.latex(retained.full[, 2])

knitr::kable(retained.full, 
             booktabs=TRUE,
             escape=FALSE,
             label="stepwise",
             col.names=c("log rate ratio", "$p$-value"), 
             align=rep("c", 2),
             caption="Stepwise regression: variables retained in model for severe disease") %>%
    group_rows("Diabetes", 6, 8)

```
