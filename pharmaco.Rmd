---
title: 'Associations of severe COVID-19 with polypharmacy in the REACT-SCOT case-control study (draft only, not to be quoted)'
author: 

  - name: Paul M McKeigue\textsuperscript{\getAff{Usher}}
    email: paul.mckeigue@ed.ac.uk
    affiliation: HPS
  - name: Sharon Kennedy
    affiliation: ISD
  - name: Amanda Weir 
    affiliation: HPS
  - name: Jen Bishop
    affiliation: HPS
  - name: Stuart J McGurnaghan
    affiliation: IGMM
  - name: David McAllister\textsuperscript{\getAff{Glasgow}} 
    affiliation: HPS
  - name: Chris Robertson\textsuperscript{\getAff{Strathclyde}} 
    affiliation: HPS
  - name: Rachael Wood
    affiliation: ISD
  - name: Nazir Lone
    affiliation: Usher
  - name: Janet Murray
    affiliation: HPS 
  - name: Thomas M Caparrotta 
    affiliation: IGMM
  - name: Alison Smith-Palmer 
    affiliation: HPS
  - name: David Goldberg
    affiliation: HPS
  - name: Jim McMenamin
    affiliation: HPS
  - name: Colin Ramsay
    affiliation: HPS
  - name: Sharon Hutchinson\textsuperscript{\getAff{GCU}} 
    affiliation: HPS
  - name: Helen M Colhoun\textsuperscript{\getAff{IGMM}}
    affiliation: HPS
address: 
  - code: Usher
    address: Usher Institute, College of Medicine and Veterinary Medicine, University of Edinburgh, Teviot Place, Edinburgh EH8 9AG, Scotland. PM - Professor of Genetic Epidemiology and Statistical Genetics. NL - Clinical Senior Lecturer in Critical Care

  - code: IGMM
    address: Institute of Genetics and Molecular Medicine, College of Medicine and Veterinary Medicine, University of Edinburgh, Western General Hospital Campus, Crewe Road, Edinburgh EH4 2XUC, Scotland. HC - Axa Chair in Medical Informatics and Epidemiology. TC - Sir George Alberti Doctoral Fellow in Pharmacoepidemiology. 

  - code: HPS
    address: Public Health Scotland, Meridian Court, 5 Cadogan Street, Glasgow G2 6QE

  - code: Glasgow
    address: Institute of Health and Wellbeing, University of Glasgow, 1 Lilybank Gardens, Glasgow G12 8RZ. DM - Wellcome Trust Intermediate Clinical Fellow and Beit Fellow 

  - code: Strathclyde
    address: Department of Mathematics and Statistics, University of Strathclyde, 16 Richmond Street, Glasgow G1 1XQ. CR - Professor of Public Health Epidemiology

  - code: GCU
    address: School of Health and Life Sciences, Glasgow Caledonian University. SH - Professor of Epidemiology and Population Health 

  - code: ISD
    address: NHS Information Services Division (Public Health Scotland), Gyle Square, 1 South Gyle Crescent, Edinburgh, EH12 9EB.  RW - Consultant in Maternal and Child Health. 

geometry: margin=1in
fontsize: 11pt
linenumbers: true
bibliography: ../covid.bib
date: "This version compiled `r gsub('^0', '', format(Sys.time(), '%d %B %Y'))`"
header-includes: |
  \let\origquote\quote
  \def\quote{\origquote\itshape}
  \usepackage{graphicx}
  \usepackage{longtable}
  \usepackage{booktabs}
  \usepackage{float}
  \usepackage{array}
  \usepackage{booktabs}
  \usepackage{longtable}
  \usepackage{lscape}
output: 
#  pdf_document:
  rticles::nejm_article:
    includes:
      in_header: ../preamble.tex
    latex_engine: lualatex
    fig_caption: true
    keep_tex: true
csl: ../../csl/styles/the-new-england-journal-of-medicine.csl
urlcolor: red

# rmarkdown::render("pharmaco.Rmd", output_file="pharmaco.pdf")

---

On behalf of Public Health Scotland COVID-19 Health Protection Study Group

```{r functions, echo=FALSE, message=FALSE}
library(knitr)
library(kableExtra)

source("helperfunctions.R")

knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)
options(knitr.kable.NA = '')

stepwise.drop.subparas[, 1] <- gsub("subpara\\.", "", stepwise.drop.subparas[, 1])

firstrow.neg <- which(stepwise.drop.subparas[, 3] < 0)[1]
rows.print <- firstrow.neg:nrow(stepwise.drop.subparas)

```

\newpage

# Abstract

_Background_-- We previously reported that dispensing of prescriptions from primary care in the past year was strongly associated with severe COVID-19 in Scotland, even in those without past diagnoses of conditions designated as increased risk (listed conditions). We report a further investigation of possible explanations for this association, which include specific co-morbidity or drug effects but also more diffuse effects of frailty or polypharmacy. 

_Methods_ -- Cases of severe COVID-19 were ascertained as all those who tested positive for SARS-CoV-2 nucleic acid in the national database and entered a critical care unit or died within 28 days of testing.  From the national population register ten controls per case were selected, matched for sex, age and general practice. International Classification of Disease (ICD-10) codes were extracted from the past three years of hospital discharge records and British National Formulary (BNF) drug codes from dispensed prescriptions issued in primary care during the past nine months. Rate ratios were estimated by conditional logistic regression. 

*Findings* -- We began by examining associations with polypharmacy, defined by total number of drug classes dispensed.  With those who had no dispensed prescriptions as reference group, rate ratios (95% CIs) for COVID-19 associated with dispensing of 12 or more drug classes were `r table.numdrugsgr.agegr[6, 4]` in those aged less than 60 years, `r table.numdrugsgr.agegr[12, 4]` in those aged 60-74 years, and `r table.numdrugsgr.agegr[18, 4]` in those aged 75 years and over.  Over all age groups the association with polypharmacy was strongest in those without hospital admissions in the past three years: in this group the rate ratio associated with dispensing of 12 or more drug classes was `r table.numdrugsgr.num.icdch[6, 4]`. The drug classes associated with COVID-19 included many drug classes previously identified as indicators of overprescribing.  A backwards elimination procedure identified proton pump inhibitors as the drug class with the largest independent contribution to the association of COVID-19 with polypharmacy.  Further analysis of this association showed a dose-response relationship with the average daily dose dispensed and that the association was strongest in younger age groups: the rate ratio for COVID-19 associated with ever-use of a proton pump inhibitor varied from `r table.everuse.protonpump[3, 3]` in those aged 75 years and over to `r table.everuse.protonpump[1, 3]` in those aged under 60 years.  The association remained after adjusting for covariates prespecified as likely confounders, and in those not prescribed any of the `r nrow(coeffs.propensity)` drug classes used to construct a propensity score.  However a comparison of time windows did not show a stronger association with recent exposure than with less recent exposure.  

*Conclusions* -- In Scotland severe COVID-19 is strongly associated with polypharmacy. This association is not easily explained by co-morbidity as it is strongest in those without relevant medical history.  Of all drug classes, proton pump inhibitors make the largest independent contribution to this association.  As prescriptions of this drug class are a recognised indicator for overprescribing of drugs, it is difficult to distinguish between causality and confounding as explanations for this association.  However the strength of the association in younger age groups and in those not on other drugs with which proton pump inhibitors are widely co-prescribed raise concern about a possible causal effect that requires further investigation in other settings.  In the meantime existing advice on reducing inappropriate polypharmacy and limiting the prescribing of proton pump inhibitors should be reinforced. 

\newpage

# Background
The REACT-SCOT study is a matched case control study of severe COVID-19 in Scotland.  In the first report of this study we reported a strong association of severe COVID-19 with having had at least one prescription dispensed in the past year [@mckeigue_rapid_2020].  The univariate rate ratios associated with at least one prescription varied from 10 in those aged under 60 years to 40 in those aged 75 years and over.  This association persisted after adjusting for care home residence, any hospital admission in the last five years and diagnoses of conditions designated as high-risk conditions for COVID-19 by the NHS and other public health agencies (hereafter listed conditions).  Partitioning of the "any prescription" variable between BNF chapters, which represent broad indication-based drug classes, showed that prescriptions in drugs in almost all chapters were associated with elevated rate ratios for COVID-19.  We concluded that although most associations of severe COVID-19 with drug prescribing were likely to be attributable to confounding by co-morbidity or frailty, causal effects of drugs on disease susceptibility could not be ruled out.  

Thus the primary aim of this study was to explore the strong association of severe COVID-19 with dispensing of at least one prescription in the past year. Specifically we aimed to test whether this association is accounted for by confounding by co-morbidity and other health-related factors, or by direct effects of prescribed drugs.  A further aim was to determine whether the effects underlying this association are sparse or diffuse.  In the case of causal drug effects, this would correspond to distinguishing between large effects of a few drugs, or an effect of polypharmacy not attributable to any single drug.  In the case of confounding, this would correspond to distinguishing between identifying a few conditions that confer high-risk of COVID-19, or a diffuse effect of multimorbidity. 

# Methods
The design of the REACT-SCOT case-control study has been described in detail elsewhere [@mckeigue_rapid_2020].  In brief, all individuals testing positive for nucleic acid for SARS-CoV-2 in Scotland up to `r format(max(cc.severe$SPECDATE, na.rm=TRUE), "%d %B %Y")` were ascertained through the Electronic Communication of Surveillance in Scotland (ECOSS) database.  Admissions to critical care were obtained from the Scottish Intensive Care Society and Audit Group (SICSAG) database that captures admission to all critical care (intensive care or high dependency) units. Death registrations up to `r format(max(cc.severe$Date.Death, na.rm=TRUE), "%d %B %Y")` were obtained from linkage to the National Register of Scotland.  Severe or fatal COVID-19 was defined by entry to critical care or death within 28 days of a positive nucleic acid test, regardless of the cause of death given on the death certificate.  The ascertainment of cases and controls is refreshed every few weeks, For this study, the accrued number of cases had increased to `r nrow(cc.severe[cc.severe$CASE==1, ])` For each case, the Community Health Index database was used to select ten controls matched for sex, one-year age band and registered with the same primary care practice, who were alive on the same day as the first date that the case tested positive [and had not embarked -- to be checked in the CHI database by SW]. Socioeconomic status was encoded as quintile of the postcode-based Scottish Index of Multiple Deprivation (SIMD). 

## Morbidity and drug prescribing
For all `r table(cc.severe$CASE)[2]` cases and `r table(cc.severe$CASE)[1]` controls, all ICD-10 diagnostic codes were extracted from the last five years of hospital discharge records in the Scottish Morbidity Record (SMR01), excluding records of discharges less than 25 days before testing positive for SARS-CoV-2.  British National Formulary (BNF) drug codes for all prescriptions dispensed since 1 June 2019 were extracted from the Scottish Prescribing Information System [@alvarez-madrazo_data_2016], excluding prescriptions dispensed 15 days or less before the date of testing positive for SARS-CoV-2 so as to include only prescriptions dispensed before the onset of symptoms.  The BNF classification groups drugs by chapter (2 digits), section (2 digits), paragraph (2 digits), subparagraph (1 digit), and chemical substance (2 characters).  BNF subparagraph codes generally represent pharmacological drug classes.  For this analysis prescription codes from chapters 14 and above, comprising dressings, appliances, vaccines, anaesthesia and other preparations were grouped as "Otherf".  Defined daily doses (DDDs) of each drug were obtained from the [DDD/ATC Index](https://www.whocc.no/atc_ddd_index/) of the WHO Collaborating Centre for Drug Statistics Methodology.  Average daily doses were calculated for each individual as the sum of (strength $\times$ quantity) over all prescriptions dispensed, divided by (interval length $\times$ DDD), where interval length is the time interval from 1 June 2019 to the cutoff of 15 days before the date that the case (in each stratum of one case and ten matched controls) first tested positive.  

# Statistical analysis 
Rate ratios for severe COVID-19 (hereafter COVID-19) were estimated from conditional logistic regression models, implemented as Cox regression in the R function `survival::clogit`.  As described previously, we derived indicator variables for a list of conditions that have been designated as risk conditions for COVID-19 by public health agencies [@nhs_whos_2020].  ICD-10 and BNF codes used for this are available with the [ENCEPP registration](http://www.encepp.eu/encepp/openAttachment/documents.otherDocument-0/35565) For this analysis this list was extended to include non-cardiac circulatory disease as analysis of the earlier version of the case-control dataset had shown this to be a risk factor for severe COVID-19.  These co-morbid conditions were assigned based on either a diagnostic code in any hospital discharge record during the last five years, or an dispensed prescription of a drug for which that condition is the only indication.  Diagnoses of diabetes were extracted from linkage to the national diabetes register and supplemented by ICD-10 codes for diabetes and BNF codes for diabetes drugs for recently diagnosed persons not on the last extract of the register .  The ICD-10 codes and drug codes used to define each variable are listed in the R scripts provided as Supplementary Material. <!-- clone the github repo -->

To investigate which drug classes contribute to the association of severe COVID-19 with number of drug classes dispensed, we carried out a backward stepwise variable selection procedure. 
Starting with a global predictor defined as the sum of indicator variables for all distinct drug classes (BNF subparagraph codes), at each iteration the procedure computed the log-likelihood of models in which each of these drug classes had been dropped before computing the global predictor.  The model with the highest log-likelihood was used to select which drug class should be dropped.  This procedure was repeated with the retained variables until only a single drug class remained.  

To study the effect of a specific drug, we constructed a propensity score based on indicator variables for prescriptions of drugs from each of the `r length(subparanames)` BNF subparagraph codes.  As the original linkage of test-positive cases and controls had been done before cases were classified as severe or otherwise, an independent dataset of `r numrows.cchosp` individuals was available to us, comprising test-positive cases who had been hospitalised but had not entered intensive care or died, together with their matched controls. By using this independent dataset to construct the propensity score, we ensured that it would not overfit the case-control dataset.  The propensity score was constructed by stepwise logistic regression with ever-use of the drug under study as dependent variable, and predictor variables as age, sex, and all `r length(subparanames.kept)` subparagraph codes for which at least 5% of case and control records had a dispensed prescription. `r nrow(coeffs.propensity)` drug classes were retained in the propensity score.  As the case-control analysis is conditioned on age and sex, the terms for age and sex were dropped when the score was computed in the case-control dataset. 

# Results
## Relation of severe COVID-19 to polypharmacy 
We began by constructing an index of polypharmacy as the number of drug classes (BNF subparagraph codes) for which at least one prescription had been dispensed during the period of observation (from 1 June 2019 to 15 days before the date of testing positive). Table \ref{tab:numdrugsgr} shows that risk of COVID-19 was strongly related to polypharmacy in all age bands: with no dispensed prescriptions as baseline category, the rate ratios (95% CIs) associated with dispensing of 12 or more drug classes were `r table.numdrugsgr.agegr[6, 4]` in those aged less than 60 years, `r table.numdrugsgr.agegr[12, 4]` in those aged 60-74 years, and `r table.numdrugsgr.agegr[18, 4]` in those aged 75 years and over. The association of COVID-19 with polypharmacy was strongest in those who had no hospital diagnoses in the previous three years (because they had not been admitted to hospital).  In this group, with the no dispensed prescriptions category as baseline, the rate ratio ranged from `r table.numdrugsgr.num.icdch[2, 4]` in those with 1 to 3 drug classes dispensed to `r table.numdrugsgr.num.icdch[6, 4]` in those with more than 12 drug classes dispensed.

To study further the relationship with polypharmacy, we restricted the analysis to those not resident in a care home and without a diagnosis of a listed condition.  The rationale for this restriction was to reduce the frequency of factors including multi-morbidity and frailty which might be expected to confound the association between polypharmacy and COVID-19.  In people with listed conditions, we might expect prescribing of multiple drugs in accordance with evidence-based guidelines for management of these conditions.  Supplementary Table \ref{tab:numdrugs.listed.any} shows that the association with COVID-19 was stronger in those without a diagnosis of a listed condition than in those with one or more listed conditions.  Residents in care homes are at high risk of severe COVID-19 for reasons unrelated to polypharmacy, and the profile of drugs most commonly prescribed to people in care homes differs from the profile of drugs most commonly prescribed to people living independently.  

## Associations of severe COVID-19 with drug classes
We next examined univariate associations of dispensing of each of the `r length(subparacols)` BNF subparagraph codes with COVID-19.  Supplementary Table \ref{tab:subpara.coeffs} shows the univariate rate ratios for the `r length(subparacols.forstepwisedrop)` drug classes that were dispensed to at least 10 cases and were associated with severe disease at $p < 0.001$.  These COVID-19-associated drug classes include widely-prescribed cardiovascular drugs and also multiple drug classes previously identified in Scotland as indicators of overprescribing: laxatives, proton pump inhibitors, hypnotics, anxiolytics, antidepressants, analgesics and nutritional supplements.  

A backward stepwise variable elimination procedure as described above was carried out to identify which specific drug classes contributed most to the association of COVID-19 with polypharmacy.  To save computation, the stepwise procedure was initiated with the subset of `r length(subparacols.forstepwisedrop)` drug classes in Table \ref{tab:subpara.coeffs} that showed univariate associations.  Figure \ref{fig:stepwise} shows how the log-likelihood changed as these variables were dropped from the model.
Dropping the first `r firstrow.neg - 1` drug classes increased the log-likelihood of the model.  The drug classes dropped at this stage included some of the most widely-prescribed drug classes that showed univariate associations with COVID-19 in Table \ref{tab:subpara.coeffs}, including lipid-lowering drugs, non-steroidal antiinflammatory agents and angiotensin-converting enzyme (ACE) inhibitors.  Only for the last `r length(rows.print)` drug classes did the log-likelihood decrease when the variable was dropped. Cardiovascular drugs retained among these `r length(rows.print)` classes were loop diuretics and calcium channel blockers.  Four classes of drugs acting on the central nervous system were retained: other antidepressant drugs (excludes tricyclics and selective serotonin reuptake inhibitors), drugs used in nausea and vertigo, antipsychotic drugs, and non-opioid analgesics.  The last drug class retained by backward selection, and thus the variable with largest independent explanatory power for the effect of polypharmacy, was proton pump inhibitors. 

## Associations of severe COVID-19 with proton pump inhibitor use
As the association of COVID-19 and exposure to proton pump inhibitors is not obviously explained by established co-morbidities, we explored this association in more depth.  As this examined a specific exposure, rather than polypharmacy which may have different profiles in care home residents or those diagnosed with listed conditions, the observations were not restricted to exclude care home residents or those diagnosed with a listed condition. Distinguishing between causality and confounding is challenging because proton pump inhibitors are usually co-prescribed with other drugs.  We used several approaches:

* Testing for a dose-response relationship 

* Adjusting for prespecified covariates: care home residence, SIMD quintile, hospital diagnosis of a disorder of the esophagus, stomach or duodenum , ever-use of non-steroidal anti-inflammatory drugs, anti-platelet agents and anticoagulants. 

* Comparison between recent and less recent time windows of exposure. 

* Stratification by propensity score for ever-use of a proton pump inhibitor.  

Table \ref{tab:dosegr.protonpump} shows that the rate ratio for COVID-19 increases with the dose of proton pump inhibitor, expressed as average DDDs/day over the period for which prescribing was observed. This relationship is strongest in younger age groups, and the effect size is reduced by about one quarter by adjusting for prespecified covariates. 
Of the five drugs in this class in the BNF, only two -- omeprazole and lansoprazole -- were widely prescribed: mean DDDs/day in controls were `r table.ppinames[3, 1]` and `r table.ppinames[2, 1]` respectively.  The effect size for unit increase in dose expressed as average DDDs/day were similar for lansoprazole [DDD 30 mg, rate ratio `r table.ppinames[2, 3]`] and omeprazole rate [DDD 20 mg, rate ratio `r table.ppinames[3, 3]`].  cy.
	
Table \ref{tab:timewindow.protonpump} compares the rate ratios associated with dispensing of at least one prescriptions for proton pump inhibitors in two time windows: up to 120 days before the cutoff date of 15 days before testing for SARS-CoV-2, more than 120 days before the cutoff date.  The rate ratio was not significantly higher in those whose only dispensed prescriptions were in the more recent time window than in those whose only dispensed prescriptions were in the less recent time window. 

A propensity score for ever-use of a proton pump inhibitor was constructed as described in the Methods section. The `r nrow(coeffs.propensity)` drug classes retained by stepwise regression, and their coefficients, are shown in Supplementary Table \ref{tab:propensity}.  As expected, the drug classes retained included NSAIDs and antiplatelet drugs, but also other drug classes such as tricyclic antidepressants that are not recognized medical indications for co-prescribing of a proton pump inhibitor. Table \ref{tab:bypropensity} shows that when the case-control dataset was stratified by propensity score, a strong association of COVID-19 with use of proton pump inhibitors remained in those with a propensity score of zero, for whom no prescription had been dispensed for any of the drug classes contributing to the propensity score. 

## Associations with other drug classes
Supplementary Tables \ref{tab:bnfchapter1}, \ref{tab:bnfchapter2}, \ref{tab:bnfchapter4} and \ref{tab:bnfchapter10} show associations with drug classes in BNF chapters 1 (gastrointestinal) 2 (cardiovascular), 4 (nervous system) and 10 (musculoskeletal).  These chapters were selected as of interest because many drugs in these chapters were associated with COVID-19 or because hypotheses about possible effects of drugs in these chapters -- ACE inhibitors [@mancia_reninangiotensinaldosterone_2020], anticoagulants [@connors_covid-19_2020], and hydroxychloroquine [@alexander_covid-19_2020]-- have been proposed or discussed.  

Table \ref{tab:bnfchapter1} shows that dispensed prescriptions of most classes of drugs for the gastrointestinal system were associated with severe COVID-19, but only proton pump inhibitors, osmotic laxatives, and aminosalicylates were independently associated with disease in a multivariate analysis.  Proton pump inhibitors were far more commonly prescribed than other drug classes in this chapter.  

Table \ref{tab:bnfchapter2} shows that prescriptions of most classes of drugs for the cardiovascular system were associated with elevated rate ratios for severe COVID-19. In a multivariate analysis the strongest associations were with loop diuretics, anticoagulants and antiplatelet drugs.  Of drug classes commonly used to treat hypertension, potassium-sparing diuretics, beta-blockers and ACE inhibitors were associated with increased risk of COVID-19 in univariate analyses, but these associations were weak or absent in a multivariate analysis. The univariate rate ratio associated with oral anticoagulants was `r table.bnfchapter2[grep("Oral anticoagulants", rownames(table.bnfchapter2)), 3]`; Adjustment for other (non-ischaemic) heart disease and ever-use of a proton pump inhibitor reduced this to `r or.ci(coeff.anticoagulant.adjusted[1], coeff.anticoagulant.adjusted[3])`.  

Table \ref{tab:bnfchapter4} shows that the strongest associations of COVID-19 with drugs for the nervous system were with drugs widely used in care homes: antipsychotics, analgesics and drugs for dementia.  Table \ref{tab:bnfchapter10} shows associations with drugs for the musculoskeletal system disaggregated by generic name, as the BNF groups all disease-modifying antirheumatic drugs under a single subparagraph code. All antirheumatic drugs were associated with elevated rate ratios for COVID-19.  The univariate rate ratio associated with hydroxychloroquine sulfate was `r table.bnfchapter10[grep("Hydroxychloroquine", rownames(table.bnfchapter10)), 3]`; adjustment for ever-use of a proton pump inhibitor reduced this to `r or.ci(coeff.hydroxychlor.adjusted[1], coeff.hydroxychlor.adjusted[3])`.  

# Discussion 
We have shown that severe COVID-19 is associated with polypharmacy, defined by the number of drugs classes dispensed during the period of observation.  We attempted to determine how much of this association is likely to be attributable to confounding by multimorbidity and frailty, and how much might be attributable to adverse effects of drugs.  Without more data on health status from primary care records, the confounders cannot be accurately measured.  We were able to show that the association with polypharmacy remains after excluding residents in care homes (who are at high risk of COVID-19 and more likely to have many drugs prescribed), remains after excluding those with conditions designated as conferring high risk, and is strongest in those who have had no hospital admissions in the last five years, who are unlikely to have multiple morbid conditions increasing susceptibility to severe COVID-19.  The rate ratios of more than 20 associated with dispensing of more than 10 drug classes are far larger than the ratio of about 2 for all-cause mortality associated with this level of polypharmacy in a systematic review [@leelakanok_association_2017] and the risk ratios of 2 to 5 for severe COVID-19 that are associated with designated conditions in this population.  
The drug classes that are strongly associated with severe COVID-19 include drugs acting on the gastrointestinal and central nervous systems that are often overprescribed, and are used as indicators of overprescribing in the Scottish National Therapeutic Index of prescribing quality [@macbride-stewart_national_2019]. 

Although a systematic search by backwards elimination identifies proton pump inhibitors as the drug class with the largest independent contribution to the association of COVID-19 with polypharmacy, this procedure is likely to retain the drug classes that are most commonly prescribed.  We have shown a clear dose-response relationship of dispensed average daily dose of proton pump inhibitors to risk of severe COVID-19.  Adjustment for covariates pre-specified as likely to confound this association -- disorders of the upper gastrointestinal tract, NSAIDs, antiplatelet agents and anticoagulants -- reduces the effect size only slightly. The rate ratios associated with exposure to proton pump inhibitors are highest in younger age groups, in whom comorbid conditions and frailty are less likely to confound this association.  

The propensity score is heavily weighted by other drug classes that are widely over-prescribed but unlikely to have direct effects on susceptibility to COVID-19: antidepressants, analgesics and nutritional supplements.  Exposure to proton pump inhibitors is not measured accurately in this study because the time of dispensing does not necessarily correspond to the time of use and because these drugs are also available over the counter.  In this situation, including many covariates in the study that are not directly related to the outcome but are strongly associated with the exposure under study may over-adjust the effect of that exposure towards the null.  By restricting the analysis to those with a propensity score of zero, who had no dispensed prescriptions for any of the `r nrow(coeffs.propensity)` drug classes that contribute to the propensity score, we are able to overcome this but the numbers of exposed cases and controls in this category are relatively small. One of the most powerful pharmacoepidemiologic methods for distinguishing causality from confounding is to compare adverse event rates by time windows of exposure among ever-users of the drug under study.  We did not detect any difference between the rate ratios associated with dispensing of a proton pump inhibitor in more recent and less recent time windows.  However most users of these drugs had prescriptions dispensed in both time windows, and users whose most recent prescription was in the earlier time window may have had a stock of tablets for use as required.  

It is thus not possible at this stage to distinguish between confounding and causality as explanations for the association of severe COVID-19 with proton pump inhibitors.  Studies in other populations, where use of proton pump inhibitors is less strongly associated with polypharmacy and where more detailed measurements of health status are available, may be able to resolve this.  If the effect is causal, the best estimate of the unconfounded effect of proton pump inhibitors in Scotland may be the rate ratio of `r round(as.numeric(gsub(" \\(.*", "", table.protonpump.bypropensity[1, 3])), 1)` in those with a propensity score of zero. 

As SARS-CoV-2 is at least partly an enteric infection [@wan_enteric_2020] and the ACE2 receptor is expressed in the intestine, it is plausible that proton pump inhibitors could increase the risk or severity of infection, either through short-term effects on gastric pH or through more persistent effects on the gut microbiome.  Uncertainties about the effect of proton pump inhibitors on the risk of community acquired pneumonia [@othman_community_2016] are not necessarily relevant to effects on enteric infection.  Proton pump inhibitors have been reported to affect the gut microbiome [@imhann_proton_2016].  If effects of proton pump inhibitor use on susceptiblity to COVID-19 are mediated through alteration of the gut microbiome, these effects would not necessarily be detected in a comparison of time windows. 
 <!---barrier to viral infection, or through altering the microbiome allowing with Warnings been issued about increased risk of _Cl. difficile_ infection from use proton pump inhibitors.  [ https://bnf.nice.org.uk/drug/omeprazole.html#importantSafetyInformations ] Given this possible association with increased risk of enteric infections --->.  

In Scotland and other countries proton pump inhibitors are widely prescribed among the elderly, often without any clear indication [@jarchow-macdonald_prescribing_2013; @marks_time_2016; @kurdi_ongoing_2018].  Initiatives to improve prescribing quality have attempted to reduce this.  It would be of interest to examine the association between severe COVID-19 and use of proton pump inhibitors in other countries where COVID-19 epidemics have been especially severe and overprescribing of proton pump inhibitors has been reported previously [@luo_changes_2018; @pasina_overuse_2020; @ramirez_overuse_2010].  

We have briefly reported associations of COVID-19 with dispensed prescriptions of drugs acting on other systems of interest. We emphasize that because of the relationship of COVID-19 to polypharmacy, associations with specific drug classes cannot be studied without taking into account how those drug classes are related to the profile of all prescribed drugs. For ACE inhibitors and angiotensin-II receptor blockers, our results are consistent with other studies that have found no increased risk associated with these drugs [@mancia_reninangiotensinaldosterone_2020].  The relation of anticoagulant use to COVID-19 is of interest because coagulopathy is a feature of severe disease [@connors_covid-19_2020].  Although in this study anticoagulants were associated with increased risk in univariate analysis, this association was was markedly reduced by adjusting for covariates including diagnosed heart disease and co-prescribing of proton pump inhibitors.  The numbers of cases and controls exposed to hydroxychloroquine in this dataset were too small for associations of severe COVID-19 with this drug to be estimated reliably. 

## Methodological strengths and weaknesses
A strength of this study is that it is based on dispensed prescriptions, rather than issued prescriptions.  Our study does not capture all exposure to drugs that are available over the counter, which include proton pump inhibitors.  Unless this misclassification of exposed individuals as unexposed differs between those not destined and those destined to develop severe COVID-19, it will lead to underestimation of the rate ratio associated with exposure to this class of drugs and underestimation of the attributable fraction.  Although we do not have morbidity data from primary care which would include risk factors such as smoking and obesity, we have diagnoses from hospital discharge records that have been coded to the ICD-10 classification by trained coders.  

## Conclusion
Severe COVID-19 is strongly associated with polypharmacy. This association is not easily explained by co-morbidity, and it is strongest in those without hospital diagnoses of conditions that confer high risk of disease.  The profile of drug prescribing associated with COVID-19 includes many drug classes that are indicators of overprescribing and inappropriate polypharmacy.  The single drug class with the greatest explanatory power for the association of COVID-19 with polypharmacy is proton pump inhibitors.  Although this study did not identify unequivocal evidence of causality for this association, effects of this drug class on susceptibility to enteric infection with SARS-CoV-2 are biologically plausible.  We recommend that public health agencies should reinforce existing guidelines on the overprescribing of proton pump inhibitors and on the avoidance of inappropriate polypharmacy.  

# Declarations
## Information governance
This study was conducted under approvals from the [Public Benefit and Privacy Panel for Health and Social Care](https://www.informationgovernance.scot.nhs.uk/pbpphsc/) that allow Health Protection Scotland staff to link any PHI controlled datasets and amendment 1617-0147 that covers transfer of diabetes data to Health Protection Scotland. Datasets were de-identified before analysis.  The study protocol was registered with the European Network of Centres for Pharmacoepidemiology and Pharmacovigilance (number [EUPAS35558](http://www.encepp.eu/encepp/viewResource.htm?id=35559)).  Requests for acccess to the data may be submitted to the Public Benefit and Privacy Panel.  

## Conflicts of interest
HC receives research support and honoraria and is a member of advisory panels or speakerâ€™s bureaus for Sanofi Aventis, Regeneron, Novartis, Novo-Nordisk and Eli Lilly. HC receives or has recently received non-binding research support from AstraZeneca and Novo-Nordisk.  HC and PM own stock in Roche and Bayer.  

## Acknowledgements
We thank all staff in critical care units who submitted data to the SICSAG database, the Scottish Morbidity Record Data Team, the staff of the National Register of Scotland, the Public Health Scotland Terminology Services, the HPS COVID-19 Laboratory & Testing cell and the NHS Scotland Diagnostic Virology Laboratories, and Nicola Rowan (HPS) for coordinating this collaboration. 

## Public Health Scotland COVID-19 Health Protection Study Group
Alice Whettlock$^1$, Allan McLeod$^1$, Andrew Gasiorowski$^1$, Andrew Merrick$^1$, Andy McAuley$^1$, April Went$^1$, Calum Purdie$^1$, Colin Fischbacher$^1$, Colin Ramsay$^1$, David Bailey$^1$, David Henderson$^1$, Diogo Marques$^1$, Eisin McDonald$^1$, Genna Drennan$^1$, Graeme Gowans$^1$, Graeme Reid$^1$, Heather Murdoch$^1$, Jade Carruthers$^1$, Janet Fleming$^1$, Jade Carruthers$^1$, Joseph Jasperse$^1$, Josie Murray$^1$, Karen Heatlie$^1$, Lindsay Mathie$^1$, Lorraine Donaldson$^1$, Martin Paton$^1$, Martin Reid$^1$, Melissa Llano$^1$, Michelle Murphy-Hall$^1$, Paul Smith$^1$, Ros Hall$^1$, Ross Cameron$^1$, Susan Brownlie$^1$, Adam Gaffney$^2$, Aynsley Milne$^2$, Christopher Sullivan$^2$, Edward McArdle$^2$, Elaine Glass$^2$, Johanna Young$^2$, William Malcolm$^2$, Jodie McCoubrey $^2$

1  Health Protection Scotland (Public Health Scotland), Meridian Court, 5 Cadogan Street, Glasgow G2 6QE. 

2  NHS National Services Scotland, Meridian Court, 5 Cadogan Street, Glasgow G2 6QE. 

## Supplementary material
The R and Rmarkdown scripts used to generate this article, which include the code used to derive variables, will be made available with this manuscript. 

# References {-}

<div id="refs"></div>


\newpage

```{r stepwise, echo=FALSE, warning=FALSE, message=FALSE, fig.height=6, out.width = "0.99\\textwidth", fig.cap="Stepwise dropping of drug classes from the polypharmacy variable: each row shows the coefficient of the polypharmacy variable with that variable retained, and the log-likelihood when that drug class is dropped"}

stepwise.asfactor <- stepwise.drop.subparas
stepwise.asfactor$name <- gsub("\\.", " ", stepwise.asfactor$name)
stepwise.asfactor$numrow <- nrow(stepwise.asfactor):1
stepwise.asfactor$name <- factor(stepwise.asfactor$name, levels=rev(stepwise.asfactor$name))

p.loglik <- ggplot(data=stepwise.asfactor, 
                   aes(x=loglik.full, y=name)) + geom_bar(stat="identity", fill="gray") +
    xlab("Log-likelihood")  +
    theme(axis.title.y=element_blank())
#          axis.text.y=element_blank())

p.coeff <- ggplot(data=stepwise.asfactor, 
                  aes(x=beta.full, y=name)) + geom_bar(stat="identity", fill="gray") +
    xlab("Coefficient (log rate ratio)")

                                        # gridExtra::grid.arrange(p.coeff, p.loglik, nrow=1, widths=c(0.5, 0.4))
p.loglik

if(FALSE) {
knitr::kable(stepwise.drop.subparas[rows.print, ], 
             escape=FALSE, 
             booktabs=TRUE,
             label="stepwise.subparas",
             row.names=FALSE,
             col.names=c("Dropped drug class", "Log rate ratio before dropping",
                         "Log-likelihood of model when dropped"), 
             digits=c(0, 2, 1), 
             caption=paste("Stepwise dropping of drug classes from the polypharmacy variable: dataset restricted to those not resident in care homes and without a listed condition")) %>%
    column_spec(column=1, width="8cm") %>%
    column_spec(column=2, width="2cm") %>%
    column_spec(column=3, width="2cm") %>%
    kable_styling(latex_options="hold_position")
}            
```

\newpage

```{r numdrugs.agegr, echo=FALSE, warning=FALSE, message=FALSE}

table.numdrugsgr <- rbind(table.numdrugsgr.agegr, table.numdrugsgr.num.icdch)

knitr::kable(table.numdrugsgr,
             escape=FALSE,
             booktabs=TRUE,
             label="numdrugsgr",
             row.names=FALSE,
             col.names=c("Number of drug classes", colnames(table.numdrugsgr.agegr)[2:3], 
                         "Rate ratio (95\\% CI)", "$p$-value"),
             caption="Association of severe COVID-19 with number of drug classes (BNF subparagraph codes) dispensed, by age group and by number of ICD chapters represented in hospital diagnoses") %>%
    column_spec(column=1, width="2cm") %>%
    group_rows("Age 0-59", 1, 6) %>%
    group_rows("Age 60-74", 7, 12) %>%
    group_rows("Age 75+", 13, 18) %>%
    group_rows("No admissions", 19, 24, hline_before=TRUE, latex_gap_space="12pt") %>% 
    group_rows("1 to 2 ICD-10 chapters in hospital diagnoses", 25, 30) %>%
    group_rows("3 or more ICD-10 chapters in hospital diagnoses", 31, 36) %>%
    kable_styling(latex_options="hold_position")
```


```{r numdrugs.num.icdch, echo=FALSE, warning=FALSE, message=FALSE}
if(FALSE) {
knitr::kable(table.numdrugsgr.num.icdch,
             escape=FALSE,
             booktabs=TRUE,
             label="numdrugs.num.icdch",
             row.names=FALSE,
             col.names=c("Number of drug classes", colnames(table.numdrugsgr.num.icdch)[2:3],  
                         "Rate ratio (95\\% CI)", "$p$-value"),
             caption="Association of severe COVID-19 with polypharmacy, by number of ICD-10 chapters represented in hospital diagnoses") %>%
    column_spec(column=1, width="2cm") %>%
    group_rows("No admissions", 1, 6) %>%
    group_rows("1 to 2 ICD-10 chapters in hospital diagnoses", 7, 12) %>%
    group_rows("3 or more ICD-10 chapters in hospital diagnoses", 13, 18) %>%
    kable_styling(latex_options="hold_position")
}
```

```{r dosegr.protonpump, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(table.dosegr.protonpump,
             escape=FALSE,
             label="dosegr.protonpump", 
             booktabs=TRUE,
             row.names=FALSE, # dose levels in column 1
             col.names=c("Average DDDs/day", colnames(table.dosegr.protonpump)[2:3], 
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             caption="Associations of severe COVID-19 with dispensed average daily dose of proton pump inhibitor (DDDs/day) grouped into categories, with and without adjustment for prespecified covariates") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Adjusted for covariates"=2)) %>%
    kable_styling(latex_options="hold_position") %>%
    group_rows("Ages 0-59 years", 1, 5) %>%
    group_rows("Ages 60-74 years", 6, 10) %>%
    group_rows("Ages 75+ years", 11, 15) %>%
    landscape()

```

```{r timewin.protonpump, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(table.timewindow.protonpump,
             escape=FALSE,
             label="timewindow.protonpump", 
             booktabs=TRUE,
             col.names=c(clean.header(colnames(table.timewindow.protonpump)[1:2]), 
                         "Rate ratio (95\\% CI)", "$p$-value"),
             caption=paste0("Associations of severe disease with dispensed prescriptions for proton pump inhibitor by ", TW, "-day time window")) %>%
	column_spec(column=1, width="3cm") %>%
	column_spec(column=2:3, width="2cm") %>%
	column_spec(column=4, width="2.5cm") %>%
	column_spec(column=5, width="1.5cm") %>%
    kable_styling(latex_options="hold_position") 

```

```{r bypropensity, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(table.protonpump.bypropensity[, 1:4],
             escape=FALSE,
             booktabs=TRUE,
             label="bypropensity", 
             col.names=c(clean.header(colnames(table.protonpump.bypropensity)[1:2]), 
                         "Rate ratio (95\\% CI)", "$p$-value"),
             caption="Association of severe COVID-19 with ever-use of proton pump inhibitor, by propensity score") %>%
    kable_styling(latex_options="hold_position")

```

\newpage
\beginsupplement

# Supplementary Tables


```{r numdrugs.listed.any, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(table.numdrugsgr.listed.any,
             escape=FALSE,
             booktabs=TRUE,
             label="numdrugs.listed.any",
             row.names=FALSE,
             col.names=c("Number of drug classes", colnames(table.numdrugsgr.listed.any)[2:3], 
                         "Rate ratio (95\\% CI)", "$p$-value"),
             caption="Association of severe COVID-19 with polypharmacy, by diagnosis of at least one listed condition") %>%
    column_spec(column=1, width="2cm") %>%
    group_rows("No listed condition", 1, 6) %>%
    group_rows("Listed condition", 7, 12) %>%
    kable_styling(latex_options="hold_position")

```

```{r subpara.coeffs, echo=FALSE, warning=FALSE, message=FALSE}

newch <- diff(as.integer(substr(subpara.coeffs$subpara, 1, 1))) !=0
linesep <- ifelse(newch, '\\addlinespace', '')
                  
knitr::kable(subpara.coeffs,
             escape=FALSE,
             longtable=TRUE, 
             booktabs=TRUE,
             linesep = linesep, 
             label="subpara.coeffs",
             row.names=FALSE,
col.names=c("BNF subparagraph", colnames(subpara.coeffs)[2:3],  
            "Rate ratio", "$p$-value"),
             caption=paste("Univariate rate ratios for severe COVID-19 associated with dispensing of each BNF subparagraph code, restricted to those not resident in care homes and without a listed condition, filtered to show only drug classes with at least 10 exposed cases and $p < 0.001$: ")) %>%
    column_spec(column=1, width="12cm") %>%
    column_spec(column=2, width="1.5cm") %>%
    column_spec(column=3, width="1.5cm") %>%
    kable_styling(latex_options="hold_position") %>%
    landscape()
            
```

```{r propensity, echo=FALSE, warning=FALSE, message=FALSE}
chapternums <- gsub("\\..*", "", coeffs.propensity[, 1])
chapternums <- floor(as.integer(chapternums) / 100000)
space.at <- which(diff(chapternums) >0)
linesep.str <- rep('', nrow(coeffs.propensity))
linesep.str[space.at] <- '\\addlinespace'

knitr::kable(coeffs.propensity,
             escape=FALSE,
             label="propensity", 
             booktabs=TRUE,
             digits=c(0, 3), 
             col.names=c("BNF subparagraph", "log odds ratio"),
			 linesep=linesep.str,
             caption="Coefficients of propensity score for prescribing of a proton pump inhibitor, constructed in an independent dataset") %>%
    kable_styling(latex_options="hold_position")

```

```{r bnfchapter1, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(table.bnfchapter1,
             escape=FALSE, 
             booktabs=TRUE,
             label="bnfchapter1",
             col.names=c(clean.header(colnames(table.bnfchapter1)[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe COVID-19 with prescribed drugs in BNF chapter 1 by subparagraph code, filtered to retain rows with at least 50 exposed individuals") %>%
    column_spec(column=1, width="4cm") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Multivariate"=2)) %>%
    kable_styling(latex_options="hold_position") %>%
    landscape()
```


```{r bnfchapter2, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(table.bnfchapter2,
             escape=FALSE, 
             booktabs=TRUE,
             label="bnfchapter2",
             col.names=c(clean.header(colnames(table.bnfchapter2)[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe COVID-19 with prescribed drugs in BNF chapter 2 by subparagraph code, filtered to retain rows with at least 50 exposed individuals") %>%
    column_spec(column=1, width="4cm") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Multivariate"=2)) %>%
    kable_styling(latex_options="hold_position") %>%
    landscape()
```

```{r bnfchapter4, echo=FALSE, warning=FALSE, message=FALSE}

knitr::kable(table.bnfchapter4,
             escape=FALSE, 
             booktabs=TRUE,
             label="bnfchapter4",
             col.names=c(clean.header(colnames(table.bnfchapter4)[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe COVID-19 with prescribed drugs in BNF chapter 4  by subparagraph code, filtered to retain rows with at least 50 exposed individuals") %>%
    column_spec(column=1, width="4cm") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Multivariate"=2)) %>%
    kable_styling(latex_options="hold_position") %>%
    landscape()
```

```{r bnfchapter10, echo=FALSE, warning=FALSE, message=FALSE}
	

rownames(table.bnfchapter10) <- tolower.exceptfirstchar(rownames(table.bnfchapter10))
rownames(table.bnfchapter10) <- gsub("\\.", " ", rownames(table.bnfchapter10))

knitr::kable(table.bnfchapter10,
             escape=FALSE, 
             booktabs=TRUE,
             label="bnfchapter10",
             col.names=c(clean.header(colnames(table.bnfchapter10)[1:2]),
                         "Rate ratio (95\\% CI)", "$p$-value",
                         "Rate ratio (95\\% CI)", "$p$-value"),
             align=rep("c", 6), 
             caption="Associations of severe COVID-19 with prescribed drugs in BNF chapter 10 by approved name, filtered to retain rows with at least 50 exposed individuals") %>%
    column_spec(column=1, width="5cm") %>%
    add_header_above(c(" "=3, "Univariate"=2, "Multivariate"=2)) %>%
    kable_styling(latex_options="hold_position") %>%
    landscape()
``````

